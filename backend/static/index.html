<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>The Weit - Premium Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #F5F1E8; color: #2C2420; font-family: 'Inter', sans-serif; }
        .stat-card { background: white; border: 2px solid #E8E3D8; border-radius: 1.5rem; }
        .btn-gold { background: linear-gradient(135deg, #C9A875, #B8976A); color: white; transition: 0.3s; }
        .chart-container { position: relative; height: 280px; width: 100%; }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ */
        .sources-toggle { border: 1px solid #E8E3D8; border-radius: 12px; margin-top: 20px; overflow: hidden; }
        .sources-header { background: #FAF9F6; padding: 12px 20px; cursor: pointer; font-weight: bold; color: #8B7355; display: flex; justify-content: space-between; }
        .sources-content { padding: 20px; display: none; background: white; border-top: 1px solid #E8E3D8; }
        .sources-content a { color: #C9A875; text-decoration: underline; display: block; margin-bottom: 8px; font-size: 0.9rem; }
    </style>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-6xl mx-auto">
        <header class="mb-12">
            <h1 class="text-5xl font-black italic">THE <span class="text-[#C9A875] not-italic">WEIT</span></h1>
            <p class="text-[10px] font-bold tracking-widest text-[#8B7355] uppercase mt-1">Global Intelligence Feed ‚Ä¢ Jan 2026</p>
        </header>

        <div class="bg-white p-8 rounded-3xl border-2 border-[#E8E3D8] shadow-xl mb-10">
            <div class="flex flex-col md:flex-row gap-4">
                <input id="urlInput" type="text" class="flex-1 p-5 rounded-2xl bg-[#FAF9F6] border-2 border-[#E8E3D8] outline-none focus:border-[#C9A875]" placeholder="Enter keyword or link for deep analysis...">
                <button id="runBtn" onclick="analyze()" class="btn-gold px-12 py-5 rounded-2xl font-black uppercase tracking-widest">Run Intelligence</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
            <div class="stat-card p-6">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase">Viral Score</p>
                <p id="vScore" class="text-5xl font-black text-[#C9A875]">‚Äî</p>
                <p class="text-[10px] text-[#8B7355] mt-2 leading-tight">–°–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –æ—Ö–≤–∞—Ç–∞. 8+ = –≤ 2.5 —Ä–∞–∑–∞ –≤—ã—à–µ –Ω–æ—Ä–º—ã.</p>
            </div>
            <div class="stat-card p-6">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase">Target Niche</p>
                <p id="vNiche" class="text-xl font-bold mt-2">‚Äî</p>
                <p class="text-[10px] text-[#8B7355] mt-2 leading-tight">–õ–∏–¥–∏—Ä—É—é—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏.</p>
            </div>
            <div class="stat-card p-6">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase">Engagement Rate</p>
                <p id="vEng" class="text-5xl font-black text-[#B8976A]">‚Äî</p>
                <p class="text-[10px] text-[#8B7355] mt-2 leading-tight">–ù–æ—Ä–º–∞ –≤ 2026: 0.40% - 5.2%.</p>
            </div>
            <div class="stat-card p-6">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase">Data Samples</p>
                <p id="vPosts" class="text-5xl font-black text-[#8B7355]">‚Äî</p>
                <p class="text-[10px] text-[#8B7355] mt-2 leading-tight">–ê–Ω–∞–ª–∏–∑ 50 –ø–æ—Å—Ç–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é Velocity.</p>
            </div>
        </div>

        <div id="charts" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
            <div class="stat-card p-8 chart-container">
                <p class="text-xs font-bold mb-4">Interest Dynamics (30 Days)</p>
                <canvas id="c1"></canvas>
            </div>
            <div class="stat-card p-8 chart-container">
                <p class="text-xs font-bold mb-4">Content Structure</p>
                <canvas id="c2"></canvas>
            </div>
        </div>

        <div class="bg-white rounded-[2.5rem] border-2 border-[#E8E3D8] shadow-2xl p-8 md:p-12 prose prose-lg max-w-none mb-20" id="reportArea">
            <p class="text-center opacity-30 italic">Standing by for analysis...</p>
        </div>
    </div>

    <script>
        let charts = {};
        async function analyze() {
            const val = document.getElementById('urlInput').value.trim();
            if(!val) return;
            const res = document.getElementById('reportArea');
            res.innerHTML = '<div class="text-center py-20 animate-pulse text-[#C9A875] font-bold uppercase tracking-widest">Accessing Global Archives...</div>';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url: val })
                });
                const data = await response.json();
                
                // –†–∞–∑–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
                const parts = data.result.split('---APPLIED_MATERIAL---');
                const mainContent = marked.parse(parts[0]);
                const sourcesContent = parts[1] ? marked.parse(parts[1]) : '–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';

                res.innerHTML = `
                    <div>${mainContent}</div>
                    <div class="sources-toggle">
                        <div class="sources-header" onclick="toggleSources()">
                            <span>üìä –ü–†–ò–ö–õ–ê–î–ù–û–ô –ú–ê–¢–ï–†–ò–ê–õ (50 –ò–°–¢–û–ß–ù–ò–ö–û–í)</span>
                            <span id="toggleIcon">+</span>
                        </div>
                        <div id="sourcesBody" class="sources-content">
                            <p class="text-xs text-[#8B7355] mb-4 italic">–ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –≤–∏–¥–µ–æ—Ä–æ–ª–∏–∫–æ–≤ –±—ã–ª —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –¥–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:</p>
                            ${sourcesContent}
                        </div>
                    </div>
                `;
                
                // –ü–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ñ—Ä
                const v = data.result.match(/Viral Score\s*\|\s*([\d/]+)/i);
                const n = data.result.match(/Product Niche\s*\|\s*([^|\n]+)/i);
                const e = data.result.match(/Engagement\s*\|\s*([\d.]+)%/i);
                const p = data.result.match(/Sources\s*\|\s*(\d+)/i);

                if(v) document.getElementById('vScore').innerText = v[1];
                if(n) document.getElementById('vNiche').innerText = n[1].trim();
                if(e) document.getElementById('vEng').innerText = e[1] + '%';
                if(p) document.getElementById('vPosts').innerText = p[1];

                document.getElementById('charts').classList.remove('hidden');
                initCharts();
            } catch (e) { res.innerHTML = 'Error communicating with The Weit API.'; }
        }

        function toggleSources() {
            const body = document.getElementById('sourcesBody');
            const icon = document.getElementById('toggleIcon');
            const isOpen = body.style.display === 'block';
            body.style.display = isOpen ? 'none' : 'block';
            icon.innerText = isOpen ? '+' : '‚àí';
        }

        function initCharts() {
            if(charts.l) charts.l.destroy();
            charts.l = new Chart(document.getElementById('c1'), {
                type: 'line',
                data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'Index', data: [12, 45, 92, 68], borderColor: '#C9A875', fill: true }] },
                options: { maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'Interest Index (0-100)' } } } }
            });
        }
    </script>
</body>
</html>