<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastMoss Clone - AI Trend Hunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes countUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
        .animate-count-up { animation: countUp 0.6s ease-out forwards; }
        .skeleton { background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%); background-size: 1000px 100%; animation: shimmer 2s infinite; }
        .prose table { border-collapse: collapse; width: 100%; margin: 1em 0; font-size: 0.9rem; }
        .prose th, .prose td { border: 1px solid #334155; padding: 0.75rem; text-align: left; }
        .prose th { background-color: #1e293b; color: #4ade80; font-weight: 700; }
        .stat-card { position: relative; overflow: hidden; }
        .stat-card:hover::before { left: 100%; }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .progress-bar { transition: width 0.3s ease; }
    </style>
</head>
<body class="bg-[#0f172a] text-white font-sans min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-4xl font-black text-green-400">FAST<span class="text-white">MOSS</span> <span class="text-xs text-slate-500 font-normal uppercase tracking-widest">Analytics Tool</span></h1>
            <button id="exportBtn" onclick="exportReport()" class="hidden bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm font-semibold transition-all flex items-center gap-2">
                üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
            </button>
        </div>
        
        <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700 mb-8 backdrop-blur-sm">
            <div class="flex flex-col md:flex-row gap-4">
                <input id="urlInput" type="text" class="flex-1 p-4 rounded-xl bg-slate-900 border border-slate-700 outline-none focus:border-green-500 transition-all" placeholder="üîó –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ...">
                <button id="runBtn" onclick="analyze()" class="bg-green-600 hover:bg-green-500 px-10 py-4 rounded-xl font-bold transition-all shadow-lg">‚ñ∂ RUN ANALYSIS</button>
            </div>
            
            <div id="aiStatus" class="hidden mt-6 flex items-center gap-3 text-sm text-slate-400">
                <div class="flex gap-1"><div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div><div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div></div>
                <span id="statusText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
            </div>
            
            <div id="progressContainer" class="hidden mt-4">
                <div class="flex justify-between text-xs text-slate-400 mb-2"><span id="progressLabel">–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö...</span><span id="progressPercent">0%</span></div>
                <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden"><div id="progressBar" class="progress-bar bg-gradient-to-r from-green-600 to-green-400 h-full" style="width: 0%"></div></div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="stat-card bg-slate-800 p-6 rounded-2xl border border-slate-700"><p class="text-slate-400 text-xs font-bold uppercase mb-2">Viral Score</p><p id="viralScore" class="text-5xl font-black text-green-400">‚Äî</p></div>
            <div class="stat-card bg-slate-800 p-6 rounded-2xl border border-slate-700"><p class="text-slate-400 text-xs font-bold uppercase mb-2">–ù–∏—à–∞</p><p id="hotCategory" class="text-xl font-bold">‚Äî</p></div>
            <div class="stat-card bg-slate-800 p-6 rounded-2xl border border-slate-700"><p class="text-slate-400 text-xs font-bold uppercase mb-2">–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</p><p id="engagement" class="text-5xl font-black text-blue-400">‚Äî</p></div>
            <div class="stat-card bg-slate-800 p-6 rounded-2xl border border-slate-700"><p class="text-slate-400 text-xs font-bold uppercase mb-2">–ê–Ω–∞–ª–∏–∑ –ø–æ—Å—Ç–æ–≤</p><p id="postsCount" class="text-5xl font-black text-purple-400">‚Äî</p></div>
        </div>

        <div id="chartsSection" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" style="display: none;">
            <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700"><canvas id="engagementChart" height="200"></canvas></div>
            <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700"><canvas id="categoryChart" height="200"></canvas></div>
        </div>

        <div class="bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden shadow-xl">
            <div class="p-6 md:p-8 prose prose-invert max-w-none" id="resultArea"><p class="text-slate-500 text-center py-12">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</p></div>
        </div>
    </div>

    <script>
        let engagementChart = null; let categoryChart = null;
        function simulateProgress() {
            const stages = [
                { text: '–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö TikTok/YouTube...', p: 35, d: 2000 },
                { text: '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ —á–µ—Ä–µ–∑ AI...', p: 75, d: 2500 },
                { text: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞...', p: 100, d: 1000 }
            ];
            let i = 0;
            function update() {
                if (i < stages.length) {
                    document.getElementById('statusText').textContent = stages[i].text;
                    document.getElementById('progressBar').style.width = stages[i].p + '%';
                    document.getElementById('progressPercent').textContent = stages[i].p + '%';
                    setTimeout(update, stages[i++].d);
                }
            }
            update();
        }

        async function analyze() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É');
            const btn = document.getElementById('runBtn');
            btn.disabled = true;
            document.getElementById('aiStatus').classList.remove('hidden');
            document.getElementById('progressContainer').classList.remove('hidden');
            simulateProgress();

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url, type: 'channel' })
                });
                const data = await response.json();
                document.getElementById('resultArea').innerHTML = marked.parse(data.result);
                
                const vScore = data.result.match(/Viral Score\s*\|\s*([\d/]+)/);
                const hCat = data.result.match(/–¢–æ–≤–∞—Ä–Ω–∞—è –Ω–∏—à–∞\s*\|\s*([^|\n]+)/);
                const eng = data.result.match(/–°—Ä–µ–¥–Ω—è—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å\s*\|\s*([\d.]+)%/);
                const pc = data.result.match(/–ü–æ—Å—Ç–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ\s*\|\s*(\d+)/);

                if(vScore) document.getElementById('viralScore').textContent = vScore[1];
                if(hCat) document.getElementById('hotCategory').textContent = hCat[1];
                if(eng) document.getElementById('engagement').textContent = eng[1] + '%';
                if(pc) document.getElementById('postsCount').textContent = pc[1];

                document.getElementById('chartsSection').style.display = 'grid';
                initCharts();
            } catch (e) { document.getElementById('resultArea').innerHTML = '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞'; }
            finally { btn.disabled = false; document.getElementById('aiStatus').classList.add('hidden'); }
        }

        function initCharts() {
            const ctx1 = document.getElementById('engagementChart').getContext('2d');
            if (engagementChart) engagementChart.destroy();
            engagementChart = new Chart(ctx1, { type: 'line', data: { labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'], datasets: [{ label: 'Engagement %', data: [5, 7, 6, 9, 12, 8, 10], borderColor: '#4ade80', tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false } });
            
            const ctx2 = document.getElementById('categoryChart').getContext('2d');
            if (categoryChart) categoryChart.destroy();
            categoryChart = new Chart(ctx2, { type: 'doughnut', data: { labels: ['Viral','Product','Educational'], datasets: [{ data: [60, 25, 15], backgroundColor: ['#4ade80','#60a5fa','#a78bfa'] }] }, options: { responsive: true, maintainAspectRatio: false } });
        }
    </script>
</body>
</html>
