<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Weit - Elite Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #F5F1E8; color: #2C2420; font-family: 'Inter', sans-serif; }
        .stat-card { background: white; border: 2px solid #E8E3D8; border-radius: 1.5rem; transition: 0.3s; }
        .stat-card:hover { border-color: #C9A875; transform: translateY(-3px); box-shadow: 0 15px 30px rgba(201,168,117,0.1); }
        .btn-gold { background: linear-gradient(135deg, #C9A875, #B8976A); color: white; font-weight: 900; letter-spacing: 1px; }
        .chart-container { position: relative; height: 280px !important; width: 100%; overflow: hidden; }
        .sources-box { border: 1px solid #E8E3D8; border-radius: 1rem; margin-top: 2rem; overflow: hidden; }
        .sources-header { background: #FAF9F6; padding: 15px 25px; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; color: #8B7355; }
        .sources-content { display: none; padding: 25px; background: white; border-top: 1px solid #E8E3D8; }
        .prose a { color: #C9A875; font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-16">
            <div>
                <h1 class="text-6xl font-black italic tracking-tighter">THE <span class="text-[#C9A875] not-italic">WEIT</span></h1>
                <p class="text-[10px] font-bold tracking-[0.4em] text-[#8B7355] mt-2 uppercase">Grounded Trend Intelligence</p>
            </div>
            <button onclick="window.print()" class="hidden md:block border-2 border-[#C9A875] text-[#C9A875] px-8 py-2 rounded-full font-bold text-[10px] hover:bg-[#C9A875] hover:text-white transition-all">EXPORT REPORT</button>
        </header>

        <section class="bg-white p-10 rounded-[2.5rem] border-2 border-[#E8E3D8] shadow-2xl mb-12">
            <div class="flex flex-col md:flex-row gap-6">
                <input id="urlInput" type="text" class="flex-1 p-5 rounded-2xl bg-[#FAF9F6] border-2 border-[#E8E3D8] outline-none focus:border-[#C9A875] transition-all text-lg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–ª–∏ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...">
                <button id="runBtn" onclick="analyze()" class="btn-gold px-14 py-5 rounded-2xl uppercase text-sm transition-all">Run intelligence</button>
            </div>
            <div id="loader" class="hidden mt-8">
                <div class="w-full bg-[#E8E3D8] h-1 rounded-full overflow-hidden">
                    <div id="loadBar" class="h-full bg-[#C9A875] transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Viral Score</p>
                <p id="mScore" class="text-6xl font-black text-[#C9A875]">‚Äî</p>
                <p class="text-[10px] text-[#A4907C] mt-4">–°–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –æ—Ö–≤–∞—Ç–∞. –û—Ü–µ–Ω–∫–∞ –Ω–∞ –±–∞–∑–µ —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ –∏–∑ 50 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Market Niche</p>
                <p id="mNiche" class="text-xl font-bold">‚Äî</p>
                <p class="text-[10px] text-[#A4907C] mt-4">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤ Google Trends.</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Engagement</p>
                <p id="mEng" class="text-5xl font-black text-[#B8976A]">‚Äî</p>
                <p class="text-[10px] text-[#A4907C] mt-4">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º —Ä—ã–Ω–∫–∞ (Avg: 5.2%).</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Data Pool</p>
                <p id="mPosts" class="text-5xl font-black text-[#8B7355]">‚Äî</p>
                <p class="text-[10px] text-[#A4907C] mt-4">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, –ø—Ä–æ—à–µ–¥—à–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é.</p>
            </div>
        </div>

        <div id="chartBox" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="stat-card p-8 chart-container"><canvas id="lineChart"></canvas></div>
            <div class="stat-card p-8 chart-container"><canvas id="donutChart"></canvas></div>
        </div>

        <main class="bg-white rounded-[2.5rem] border-2 border-[#E8E3D8] shadow-2xl overflow-hidden mb-20">
            <div id="reportArea" class="p-10 md:p-16 prose prose-lg max-w-none">
                <p class="text-center opacity-10 italic py-20 tracking-widest uppercase font-black">Waiting for signal...</p>
            </div>
        </main>
    </div>

    <script>
        let charts = {};
        async function analyze() {
            const val = document.getElementById('urlInput').value.trim();
            if(!val) return;
            const btn = document.getElementById('runBtn');
            const res = document.getElementById('reportArea');
            const bar = document.getElementById('loadBar');
            
            btn.disabled = true;
            document.getElementById('loader').classList.remove('hidden');
            res.innerHTML = '<div class="text-center py-20 font-bold text-[#C9A875]">PARSING DATA & CLUSTERING TRENDS...</div>';
            bar.style.width = '40%';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url: val })
                });
                const data = await response.json();
                bar.style.width = '100%';
                
                const parts = data.result.split('---APPLIED_MATERIAL---');
                const mainHtml = marked.parse(parts[0]);
                const sourceHtml = parts[1] ? marked.parse(parts[1]) : '–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è...';

                res.innerHTML = `
                    <div>${mainHtml}</div>
                    <div class="sources-box">
                        <div class="sources-header" onclick="toggleSources()">
                            <span>üìÇ –ü–†–ò–ö–õ–ê–î–ù–û–ô –ú–ê–¢–ï–†–ò–ê–õ (REAL SOURCES)</span>
                            <span id="tIcon">+</span>
                        </div>
                        <div id="sBody" class="sources-content">${sourceHtml}</div>
                    </div>
                `;

                // –ê–≤—Ç–æ-–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
                const v = data.result.match(/Viral Score\s*\|\s*([\d/]+)/i);
                const n = data.result.match(/Product Niche\s*\|\s*([^|\n]+)/i);
                const e = data.result.match(/Engagement\s*\|\s*([\d.]+)%/i);
                const p = data.result.match(/Sources\s*\|\s*(\d+)/i);

                if(v) document.getElementById('mScore').innerText = v[1];
                if(n) document.getElementById('mNiche').innerText = n[1].trim();
                if(e) document.getElementById('mEng').innerText = e[1] + '%';
                if(p) document.getElementById('mPosts').innerText = p[1];

                document.getElementById('chartBox').classList.remove('hidden');
                updateCharts();
            } catch (err) { res.innerHTML = 'Error. Rate limit or connection issues.'; }
            finally { btn.disabled = false; setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1000); }
        }

        function toggleSources() {
            const b = document.getElementById('sBody');
            const i = document.getElementById('tIcon');
            const open = b.style.display === 'block';
            b.style.display = open ? 'none' : 'block';
            i.innerText = open ? '+' : '‚àí';
        }

        function updateCharts() {
            if(charts.l) charts.l.destroy();
            charts.l = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'Interest Index', data: [10, 50, 95, 70], borderColor: '#C9A875', fill: true, backgroundColor: 'rgba(201,168,117,0.05)' }] },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Index (0-100)' } } } }
            });
            if(charts.d) charts.d.destroy();
            charts.d = new Chart(document.getElementById('donutChart'), {
                type: 'doughnut',
                data: { labels: ['Viral', 'Story', 'ASMR'], datasets: [{ data: [55, 30, 15], backgroundColor: ['#C9A875', '#B8976A', '#E8E3D8'], borderWidth: 0 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    </script>
</body>
</html>