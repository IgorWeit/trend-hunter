<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Weit - Premium Trend Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #F5F1E8; color: #2C2420; font-family: 'Inter', sans-serif; }
        .stat-card { background: white; border: 2px solid #E8E3D8; border-radius: 1.5rem; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .stat-card:hover { border-color: #C9A875; transform: translateY(-5px); box-shadow: 0 20px 40px rgba(201, 168, 117, 0.15); }
        .btn-gold { background: linear-gradient(135deg, #C9A875, #B8976A); color: white; box-shadow: 0 10px 20px rgba(201, 168, 117, 0.3); }
        .chart-wrapper { position: relative; height: 300px !important; width: 100%; }
        .prose h3 { color: #C9A875; border-bottom: 1px solid #E8E3D8; padding-bottom: 0.5rem; margin-top: 2rem; }
        .prose strong { color: #8B7355; }
        .metric-desc { font-size: 0.75rem; color: #8B7355; margin-top: 0.5rem; line-height: 1.3; }
        .line-art { position: fixed; opacity: 0.03; pointer-events: none; z-index: -1; }
    </style>
</head>
<body class="p-6 md:p-12">
    <svg class="line-art top-10 right-10" width="400" height="400" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="#8B7355" fill="none" stroke-width="0.5"/></svg>
    <svg class="line-art bottom-10 left-10" width="300" height="300" viewBox="0 0 100 100"><path d="M10 90 L90 10" stroke="#8B7355" stroke-width="0.5"/></svg>

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-16">
            <div>
                <h1 class="text-6xl font-black tracking-tighter italic">THE <span class="text-[#C9A875] not-italic">WEIT</span></h1>
                <p class="text-[#8B7355] font-bold tracking-[0.3em] text-[10px] uppercase mt-2">Elite Market & Trend Analysis</p>
            </div>
            <button id="exportBtn" onclick="window.print()" class="hidden border-2 border-[#C9A875] text-[#C9A875] px-6 py-2 rounded-full font-bold text-xs hover:bg-[#C9A875] hover:text-white transition-all">
                EXPORT PDF
            </button>
        </header>

        <div class="bg-white p-10 rounded-[2.5rem] border-2 border-[#E8E3D8] shadow-2xl mb-12">
            <div class="flex flex-col md:flex-row gap-6">
                <input id="urlInput" type="text" class="flex-1 p-5 rounded-2xl bg-[#FAF9F6] border-2 border-[#E8E3D8] outline-none focus:border-[#C9A875] transition-all text-lg" placeholder="Вставьте ссылку на канал или ключевое слово...">
                <button id="runBtn" onclick="analyze()" class="btn-gold px-12 py-5 rounded-2xl font-black text-sm uppercase tracking-widest transition-all">Run Intelligence</button>
            </div>
            <div id="loader" class="hidden mt-8">
                <div class="flex justify-between text-[10px] font-bold text-[#8B7355] mb-2">
                    <span id="loadText">SCANNING GLOBAL TRENDS...</span>
                    <span id="loadPerc">0%</span>
                </div>
                <div class="w-full bg-[#E8E3D8] h-1 rounded-full overflow-hidden">
                    <div id="loadBar" class="h-full bg-[#C9A875] transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Viral Score</p>
                <p id="mScore" class="text-6xl font-black text-[#C9A875]">—</p>
                <p class="metric-desc">Скорость роста охвата. 8+ означает взрывной тренд, обходящий алгоритмы в 2.5 раза быстрее нормы.</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Niche Potential</p>
                <p id="mNiche" class="text-xl font-bold">—</p>
                <p class="metric-desc">Определенная ИИ товарная ниша с наивысшим ROI в TikTok Shop и YouTube Shorts.</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Engagement Rate</p>
                <p id="mEng" class="text-5xl font-black text-[#B8976A]">—</p>
                <p id="mBench" class="metric-desc">Сравнение с бенчмарком. Отражает реальную связь контента с аудиторией.</p>
            </div>
            <div class="stat-card p-8">
                <p class="text-[10px] font-bold text-[#8B7355] uppercase tracking-widest mb-4">Data Pool</p>
                <p id="mPosts" class="text-5xl font-black text-[#8B7355]">—</p>
                <p class="metric-desc">Выборка из 50 наиболее виральных постов, послуживших базой для этого анализа.</p>
            </div>
        </div>

        <div id="chartSection" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="stat-card p-8 chart-wrapper">
                <p class="text-xs font-bold mb-4">Динамика спроса (30 дней)</p>
                <canvas id="chartLine"></canvas>
            </div>
            <div class="stat-card p-8 chart-wrapper">
                <p class="text-xs font-bold mb-4">Структура трафика (по форматам)</p>
                <canvas id="chartDonut"></canvas>
            </div>
        </div>

        <div class="bg-white rounded-[2.5rem] border-2 border-[#E8E3D8] shadow-2xl overflow-hidden mb-20">
            <div id="reportArea" class="p-10 md:p-16 prose prose-lg max-w-none">
                <div class="text-center opacity-20 py-32">
                    <p class="text-4xl font-black italic">THE WEIT</p>
                    <p class="text-sm tracking-widest mt-2">WAITING FOR COMMAND...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let charts = {};

        async function analyze() {
            const val = document.getElementById('urlInput').value.trim();
            if(!val) return;
            
            const btn = document.getElementById('runBtn');
            const area = document.getElementById('reportArea');
            const bar = document.getElementById('loadBar');
            
            btn.disabled = true;
            document.getElementById('loader').classList.remove('hidden');
            area.innerHTML = '<p class="text-center italic py-20">Accessing global trend databases...</p>';
            bar.style.width = '30%';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url: val })
                });
                const data = await response.json();
                bar.style.width = '100%';
                
                area.innerHTML = marked.parse(data.result);
                
                // Извлечение данных для карточек
                const v = data.result.match(/Viral Score\s*\|\s*([\d/]+)/i);
                const n = data.result.match(/Product Niche\s*\|\s*([^|\n]+)/i);
                const e = data.result.match(/Engagement\s*\|\s*([\d.]+)%/i);
                const eb = data.result.match(/Benchmark\s*\|\s*([^|\n]+)/i);
                const p = data.result.match(/Sources\s*\|\s*(\d+)/i);

                if(v) document.getElementById('mScore').innerText = v[1];
                if(n) document.getElementById('mNiche').innerText = n[1].trim();
                if(e) document.getElementById('mEng').innerText = e[1] + '%';
                if(eb) document.getElementById('mBench').innerText = "Benchmark: " + eb[1].trim();
                if(p) document.getElementById('mPosts').innerText = p[1];

                document.getElementById('chartSection').classList.remove('hidden');
                document.getElementById('exportBtn').classList.remove('hidden');
                initCharts();
            } catch (err) {
                area.innerHTML = '<p class="text-red-500">Ошибка связи с сервером The Weit.</p>';
            } finally {
                btn.disabled = false;
                setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1000);
            }
        }

        function initCharts() {
            if(charts.l) charts.l.destroy();
            if(charts.d) charts.d.destroy();

            const lineCtx = document.getElementById('chartLine').getContext('2d');
            charts.l = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: ['Нед 1', 'Нед 2', 'Нед 3', 'Нед 4'],
                    datasets: [{
                        label: 'Индекс интереса (0-100)',
                        data: [20, 45, 85, 65],
                        borderColor: '#C9A875',
                        backgroundColor: 'rgba(201,168,117,0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { 
                    maintainAspectRatio: false, 
                    scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Упоминания/Запросы' } } } 
                }
            });

            const donutCtx = document.getElementById('chartDonut').getContext('2d');
            charts.d = new Chart(donutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Обзоры', 'Storytelling', 'Лайфхаки'],
                    datasets: [{
                        data: [50, 30, 20],
                        backgroundColor: ['#C9A875', '#B8976A', '#E8E3D8'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    </script>
</body>
</html>