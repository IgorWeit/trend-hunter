import os
import google.generativeai as genai

def analyze_trend(data):
    api_key = os.environ.get("GOOGLE_API_KEY")
    if not api_key: 
        return "–û–®–ò–ë–ö–ê: API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω."

    try:
        genai.configure(api_key=api_key)
        
        # –§–∏–∫—Å–∏—Ä—É–µ–º –æ–¥–Ω—É —Å–∞–º—É—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –º–æ–¥–µ–ª—å
        model_name = 'gemini-1.5-flash'
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞
        # API —Å–∞–º–æ –ø–æ–π–º–µ—Ç —ç—Ç–æ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
        model = genai.GenerativeModel(
            model_name=model_name,
            tools=['google_search'] 
        )
        
        prompt = f"""
        –¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è The Weit.
        –ü—Ä–æ–≤–µ–¥–∏ –ø–æ–∏—Å–∫ –∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "{data}"
        
        1. –ù–∞–π–¥–∏ 50 —Ä–µ–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤–∏–¥–µ–æ YouTube –∏ —Ç—Ä–µ–Ω–¥—ã).
        2. –°–¥–µ–ª–∞–π –∞–Ω–∞–ª–∏–∑ –¥—Ä–∞–º–∞—Ç—É—Ä–≥–∏–∏ –∏ —Å—é–∂–µ—Ç–∞ –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.
        
        –§–û–†–ú–ê–¢ –û–¢–ß–ï–¢–ê:
        ### üìä –¢–ê–ë–õ–ò–¶–ê –ú–ï–¢–†–ò–ö
        | Metric | Value | Comparison |
        | :--- | :--- | :--- |
        | Viral Score | [0-10] | [–û—Ü–µ–Ω–∫–∞] |
        | Product Niche | [–ù–∏—à–∞] | [–¢—Ä–µ–Ω–¥] |
        | Engagement | [0.0]% | [Vs 5.2%] |
        | Data Sources | 50 | [Verified] |

        ### üé¨ –†–ê–ó–ë–û–† –°–¢–†–ê–¢–ï–ì–ò–ò
        **–°—é–∂–µ—Ç:** ...
        **–°–º—ã—Å–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** ...
        **–î—Ä–∞–º–∞—Ç—É—Ä–≥–∏—è:** (–∞–Ω–∞–ª–∏–∑ –∑–∞—Ü–µ–ø–æ–∫ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è)
        **–í–∏–¥–µ–æ—Ä—è–¥:** ...
        **–û–∑–≤—É—á–∫–∞:** ...
        **–ö–ª—é—á–µ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä —É—Å–ø–µ—Ö–∞:** ...
        **–í—ã–≤–æ–¥:** ...

        ---APPLIED_MATERIAL---
        **–†–ï–ê–õ–¨–ù–´–ï –ò–°–¢–û–ß–ù–ò–ö–ò –ê–ù–ê–õ–ò–ó–ê:**
        (–í—ã–≤–µ–¥–∏ —Å–ø–∏—Å–æ–∫ –∏–∑ 5-10 —Ä–µ–∞–ª—å–Ω—ã—Ö URL-–∞–¥—Ä–µ—Å–æ–≤ YouTube, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–±–æ–π –≤ –ø–æ–∏—Å–∫–µ)
        """
        
        response = model.generate_content(prompt)
        return response.text

    except Exception as e:
        # –ï—Å–ª–∏ –¥–∞–∂–µ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–≤–æ–¥–∏–º —á–∏—Å—Ç—É—é –æ—à–∏–±–∫—É –±–µ–∑ –æ–±—ë—Ä—Ç–æ–∫
        return f"–û—à–∏–±–∫–∞ API: {str(e)}"