import os
import google.generativeai as genai

def analyze_trend(data):
    api_key = os.environ.get("GOOGLE_API_KEY")
    if not api_key: return "–û–®–ò–ë–ö–ê: API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω."

    try:
        genai.configure(api_key=api_key)
        # –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ–π –º–æ–¥–µ–ª–∏
        models = [m.name for m in genai.list_models() if 'generateContent' in m.supported_generation_methods]
        selected = next((m for m in ['models/gemini-1.5-pro', 'models/gemini-1.5-flash'] if m in models), models[0])
        model = genai.GenerativeModel(selected)
        
        prompt = f"""
        –¢—ã ‚Äî –≤–µ–¥—É—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≤–∏—Ä–∞–ª—å–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤ The Weit. 
        –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å: {data}
        
        –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞—á–Ω–∏ –æ—Ç—á–µ—Ç —Å —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã (–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞):
        | Metric | Value | Benchmark |
        | :--- | :--- | :--- |
        | Viral Score | [0-10] | Avg: 4.5 |
        | Product Niche | [–ù–∞–∑–≤–∞–Ω–∏–µ] | Market Trend |
        | Engagement | [0.0]% | Sector Avg: 5.2% |
        | Sources | 50 | Verified Posts |

        –ó–ê–¢–ï–ú –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:
        
        ### üé¨ –°–¢–†–£–ö–¢–£–†–ê –£–°–ü–ï–•–ê
        **–°—é–∂–µ—Ç:** [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
        **–°–º—ã—Å–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** [–í —á–µ–º —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∑—Ä–∏—Ç–µ–ª—è]
        **–î—Ä–∞–º–∞—Ç—É—Ä–≥–∏—è:** [–ö–∞–∫ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç/–∏–Ω—Ç—Ä–∏–≥–∞]
        **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** [–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∏–Ω–≥]
        **–í–∏–¥–µ–æ—Ä—è–¥:** [–¢–∏–ø—ã –∫–∞–¥—Ä–æ–≤, –º–æ–Ω—Ç–∞–∂]
        **–û–∑–≤—É—á–∫–∞:** [–¢–æ–Ω, –º—É–∑—ã–∫–∞, –∑–∞–∫–∞–¥—Ä–æ–≤—ã–π –≥–æ–ª–æ—Å]
        **–î—Ä—É–≥–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** [–°–≤–µ—Ç, —Å—É–±—Ç–∏—Ç—Ä—ã, –ø—Ä–∏–∑—ã–≤—ã]
        
        ### üí° –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï
        **–ö–ª—é—á–µ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä —É—Å–ø–µ—Ö–∞:** [–û–¥–Ω–∞ –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç–∏]
        **–í—ã–≤–æ–¥:** [–ë–∏–∑–Ω–µ—Å-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è]

        ### üîó –ü–†–ò–ö–õ–ê–î–ù–û–ô –ú–ê–¢–ï–†–ò–ê–õ
        **–°—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ:** 1. [–ü—Ä–∏–º–µ—Ä 1](URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ)
        2. [–ü—Ä–∏–º–µ—Ä 2](URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ)
        3. [–ü—Ä–∏–º–µ—Ä 3](URL –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ)
        """
        
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: {str(e)}"